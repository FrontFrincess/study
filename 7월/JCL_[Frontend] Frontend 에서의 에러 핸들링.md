# Frontend에서의 에러 핸들링

![Desktop - 14](https://github.com/chaedev3/CS/assets/109324466/85184e0e-c16f-4675-9576-bd0313299492)

<br/>

프론트 스터디 주제를 찾아 헤매던 중 .. 이런 동영상을 보게 되었다 !! 

https://www.youtube.com/watch?v=FXtooPhupr4 

뭐랄까 지금까지 했던 프로젝트에 대한 반성(?) 이 되는 영상이었는데 오늘은 그래서 이 영상에 나온 내용들을 정리하고 나의 경험을 회고하는 식으로 진행해볼까 한다!! 

<br/>

프로젝트를 진행하면서 아마 수많은 에러들과 마주했을 것이라고 생각된다. 일단 Typescript 를 쓰면 늘 마주하는 빨간줄부터 백앤드를 째려보게 되는 500 에러, 갑자기 사용자가 많아지니까 안된다던지 등등 수도 없이 많은 에러와 마주해왔을 것이다.. 

<br/>

그렇다면 Hoxy.. **에러**와 **예외**의 차이를 아시나요? 

## ⭐ 오류(Error) 와 예외(Exception)

프로그래밍에서 오류와 예외의 정의는 다음과 같다. 

<br/>

#### 💗  오류(Error) 

> 하드웨어의 고장 또는 소프트웨어가 본래의 동작을 할 수 없는 상태를 오류라고 한다. 발생하는 시점에 따라 에러를 분류하면 컴파일 에러와 런타임 에러로 나눌 수 있다. 

<br/>

##### ❓ 컴파일 에러(Compile Error) : 코드가 컴파일 될 때 컴파일러가 해석하지 못해서 발생하는 오류

즉, 우리가 Typescript 에서 매번 마주하는 문법 잘못 쓴 건 컴파일 에러에 해당하는 것이다! 

<br/>

##### ❓ 런타임 에러(Runtime Error) : 프로그램이 동작할 때 발견할 수 있는 에러 

즉, Try Catch 구문에서 잡히는 에러를 말한다! 

<br/> 물론 Javascript 는 동적 타입의 인터프리터 언어고 Typescript 는 정적 타입의  컴파일 언어이기 때문에 **Javascript** 는 컴파일 단계가 없이 실행과 동시에 한 줄씩 중간 언어로 해석한 다음 실행하기 때문에 <u>모든 에러가 런타임 환경</u>에서 발생되지만 **Typescript**는 <u>컴파일 단계에서 SyntaxError or TypeError를 막아</u>준다!!  

<br/>

우리가 예외 처리할 때를 생각해보면 Try Catch 를 사용해서 error 일 경우에 행해져야 할 행동을 적어두곤 한다. 그러니까 Javascript에서의 예외는 런타임에러라고 생각하면 된다!! 

#### 💗  예외(Exception) 

> 런타임 오류와 같은 것을 의미. 예상하기 어렵거나 예상이 불가능한 이슈를 의미 

<br/>

그러니까 우리는 이 예외들을 처리하여 프로그램이 예상치 못하게 종료되거나 제 기능을 못하는 것을 방지해야 한다. 이렇게 예외로 인해 발생한 에러 객체를 핸들링하는 것을 **에러핸들링**이라고 한다. 

<br/> 그렇다면 우리는 왜 에러핸들링을 해야할까? 

## ⭐ 에러핸들링의 필요성

내가 진행한 프로젝트를 예로 들어서 생각해보면 특화 프로젝트였던 'OMZ'에서 얼굴상을 Tensorflow로 분석해서 해당하는 3D 동물을 리턴하는 식이었는데 예상치 못한 에러가 발생했다.   

  ![SignUp](https://github.com/chaedev3/CS/assets/109324466/35eaf855-057e-4cae-ab7e-fd7e82d22d68)

 여기서 발생한 두 가지 문제 ! 첫 번째는 분석 되는데 시간이 너무 오래 걸리는데 왜 때문인지 loading 중이 돌아가지 않아 참을성 없는 유저들을 떠나보내게 됐고 두 번째는 사진이 너무 고화질이면 동물상으로 넘어가지 않아 회원가입에서 많은 유저들을 떠나보내게 되었다.. 

<br/> 

리팩토링을 하면 고쳐야 할 1순위인 이 녀석 .. 예외 처리를 제대로 했다면 수 많은 유저들을 떠나보내지 않았을 것이다.. 

지금와서 고친다면 가장 먼저 Nginx 상에서 허용되는 파일의 용량을 키워볼 것 같고 거기서도 안 올려지는 사진에 대해서는 try catch 를 이용해서 용량이 너무 크니까 다른 사진을 업로드해주라고 메세지를 띄웠을 것이다 ..!! 

<br/>

**즉, 에러핸들링을 이용하여 에러에 대한 인지, 다른 행동을 할 수 있도록 유도하면 서비스에 대한 부정적인 경험을 막을 수 있을 것이다.** 

<br/>

다음으로는 에러에는 어떤 것들이 있는 지 알아보자!! 

##  ⭐ 에러의 분류

![Desktop - 16](https://github.com/chaedev3/CS/assets/109324466/285196de-4fe4-4662-b8a0-ae013dfe3b51)

에러를 분류하자면 다음과 같다.

<br/>

#### 💗  예측 가능한 에러

- 서버 API 로부터 전달받는 에러 중 **status 코드가 명확한 에러**는 (ex. 401 - 권한이 없는 에러, 403 - 잘못된 접근의 에러) 는 상황에 맞게 에러를 처리할 수 있기 때문에 **예측 가능한 에러**라고 한다.

<br/>

#### 💗  예측 불가능한 에러

- 서버 API로부터 전달받는 에러 중 **500대 에러**는 예측할 수 없는 에러로 분류한다. 사용자의 네트워크 환경이나 브라우저 환경에서 발생할 수 있는 에러는 **예측 불가능한 에러**로 분류한다. 

<br/>

#### 💗 해결 가능한 에러

- **사용자가 에러 상황을 이해**해서 해결 가능한 에러를 말한다. 
- 예를 들면, 인증 또는 권한에 대한 에러가 될 수 있다. 예를 들면, 로그인이 되지 않은 사용자가 서비스를 이용하려고 할 때 로그인을 할 수 있도록 로그인 화면을 보여줄 수 있다. 
- 또한, 사용자가 없는 경로로 들어왔을 경우 404 page를 보여줘서 메인으로 돌아가게 할 수 있다. 

<br/>

#### 💗 해결 불가능한 에러 

- **사용자에게 상황을 말해줘도 해결이 불가능**한 에러를 말한다. 
- 예를 들면, 저사양 기기 또는 브라우저에서 동작하지 않는 코드가 포함되어 있을 경우, 에러 메세지를 보여줘도 사용자는 할 수 있는 것이 없다.

<br/>

그렇다면 이러한 에러를 어떻게 핸들링 할 것인가!!! 

##  ⭐ 에러핸들링

에러의 분류 그림에서 나누었던 기준으로 에러핸들링을 설명하기 전에 에러핸들링의 기초가 되는 Try Catch 문부터 살펴보자! 

<br/>

##### Try  

- 에러가 발생할 수도 있는 로직을 작성, 에러가 발생하면 에러객체(name, message 프로퍼티가 존재)를 Catch로 Throw 함 

##### Catch 

- 만약 에러가 발생했다면 Catch 가 받음

##### Finally 

- 로직의 성공 & 실패 여부와 상관없이 실행해야 하는 부분이 있다면 finally 를 사용하면 무조건 실행되게 됨 

```javascript
const crewNickname = "채린"; 

openFrontFrincess();
try {
    loveFrontFrincess(crewNickname); 
} catch (error) {
    console.error("당신은 공주가 아닙니다."); 
} finally {
    closeFrontFrincess(); 
}
```

<br/>

대충 작성해보면 이런 식으로 작성하면 되는데 .. 나 같은 경우는 프로젝트에서 React Query 를 사용했기 때문에 좀 더 간편하게 에러를 잡을 수 있었다. 

omz 코드 일부 발췌.. 

```javascript
// article 상세 정보 받아오기
const { data, isLoading, isError, error, refetch } = useQuery("article", () =>
    getArticle(boardId, memberId)
  );

if (isError) return <p className="title">Error...</p>; 
```

- React Query 에서는 isError 로 error 가 났는지 안났는지 확인할 수 있고 error 로 어떤 에러인지 확인할 수 있다.  

즉, error code 또는 메시지등을 활용하여 보다 정확한 오류의 원인에 따라 사용자에게 가이드를 주거나 안내를 할 수 있다. 

<br/>

#### 💗 예상 가능 & 해결 가능한 에러 

- ##### 인증 에러  - 401 Unauthorized Error 

  - 아래와 같이 로그인을 하지 않았다면 로그인을 할 수 있도록 모달을 띄워 안내했다. 

​		![221097194-8912528f-66f2-43ad-9cb7-4cdfe129ae14](https://github.com/chaedev3/CS/assets/109324466/1c5f7a02-9976-4998-9efb-e4557b44229a)

- ##### 잘못된 접근으로 인한 에러  - 404 Not Found!  

  - 404 페이지를 따로 만들어서 메인으로 돌아갈 수 있도록 해주었다. 

<img width="1440" alt="404@2x" src="https://github.com/chaedev3/CS/assets/109324466/7dabde26-4e27-4aa3-b56e-cc55cc6079c0"> 

- ##### 어플리케이션에서 정의한 에러  - Try Catch 를 이용해서 가이드를 줘야 한다!  	

#### 💗 예상 가능 & 해결 불가능한 에러 

- ##### 사용자의 고의적인 에러  /  악의적인 목적의 접근 또는 사용 

  - 이 경우는 사용자가 고의적으로 비정상적인 접근을 한 경우인데 이 경우 보안상 허점이 있는 부분이니 에러 처리를 잘 해주어야 한다.

#### 💗 예상 불가능 & 해결 가능한 에러 

- ##### 일시적인 네트워크 에러

  - 가장 쉬운 해결책은 '일시적인 에러' 임을 말해주고 바로 이전 액션을 다시 시도할 수 있는 가이드를 제공해주는 것이다.

#### 💗 예상 불가능 & 해결 불가능한 에러 

- ##### 브라우저에서 발생하는 에러  / 서비스 장애 상황 

  - 이 에러들의 경우에는 사용자가 스스로 해결해나갈 수 없는 오류이기 때문에 예를 들면 고객센터로 진입할 수 있게 해준다던지 등으로 에러핸들링을 할 수 있다.  

  - 또한 개발자의 제어권 밖에 있는 에러이기 때문에 Sentry 같은 도구를 사용해 모니터링을 수시로 해서 사용자가 해당 화면을 마주할 일이 없도록 수정해야 한다.  



그렇다면.. 모든 에러가 발생하면 무조건 try - catch 로 감싸주면 되는걸까..? 그건 아니다.. 너무 무조건적으로 try catch 를 사용하는 것은 지양!!  일단 catch로 넘어가는 에러가 분기 처리를 하지 않으면 명확하게 알 수 없다는 점, 모든 예외 상황에 대해 캐치를 했을 경우 오류를 해결하는 것이 아니라 숨기는 것에 불과함 

성공하는 여부에 대해서만 다루고, 실패하는 경우 외부에 위임하는 것이 가장 추천하는 방법 .. !! 



조금 부족한 듯 하여 내일 조금 고칠게요 .. ㅎㅎ 

#### **📒 참고**  

https://catsbi.oopy.io/92cfa202-b357-4d47-8de2-b9b3968dfb2e 

https://www.youtube.com/watch?v=FXtooPhupr4 

https://yjohbjects.tistory.com/6 

https://jbee.io/react/error-declarative-handling-2/ 